<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>App Packaging &mdash; Python Serverless Microframework for AWS 1.15.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.15.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Python Serverless Microframework for AWS 1.15.1 documentation" href="../index.html" />
    <link rel="next" title="Python Version Support" href="pyversion.html" />
    <link rel="prev" title="Chalice Stages" href="stages.html" />
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="app-packaging">
<h1>App Packaging<a class="headerlink" href="#app-packaging" title="Permalink to this headline">¶</a></h1>
<p>In order to deploy your Chalice app, a zip file is created that
contains your application and all third party packages your application
requires.  This file is used by AWS Lambda and is referred
to as a deployment package.</p>
<p>Chalice will automatically create this deployment package for you, and offers
several features to make this easier to manage.  Chalice allows you to
clearly separate application specific modules and packages you are writing
from 3rd party package dependencies.</p>
<div class="section" id="app-directories">
<h2>App Directories<a class="headerlink" href="#app-directories" title="Permalink to this headline">¶</a></h2>
<p>You have two options to structure application specific code/config:</p>
<ul class="simple">
<li><strong>app.py</strong> - This file includes all your route information and is always
included in the deployment package.</li>
<li><strong>chalicelib/</strong> - This directory (if it exists) is included in the
deployment package.  This is where you can add config files and additional
application modules if you prefer not to have all your app code in the
<code class="docutils literal"><span class="pre">app.py</span></code> file.</li>
</ul>
<p>See <a class="reference internal" href="multifile.html"><span class="doc">Multifile Support</span></a> for more info on the <code class="docutils literal"><span class="pre">chalicelib/</span></code> directory.  Both the
<code class="docutils literal"><span class="pre">app.py</span></code> and the <code class="docutils literal"><span class="pre">chalicelib/</span></code> directory are intended for code that you
write yourself.</p>
</div>
<div class="section" id="rd-party-packages">
<h2>3rd Party Packages<a class="headerlink" href="#rd-party-packages" title="Permalink to this headline">¶</a></h2>
<p>There are two options for handling python package dependencies:</p>
<ul class="simple">
<li><strong>requirements.txt</strong> - During the packaging process, Chalice will
install any packages it finds or can build compatible wheels for.
Specifically all pure python packages as well as all packages that upload
wheel files for the <code class="docutils literal"><span class="pre">manylinux1_x86_64</span></code> platform will be automatically
installable.</li>
<li><strong>vendor/</strong> - The <em>contents</em> of this directory are automatically added to
the top level of the deployment package.</li>
</ul>
<p>Chalice will also check for an optional <code class="docutils literal"><span class="pre">vendor/</span></code> directory in the project
root directory.  The contents of this directory are automatically included in
the top level of the deployment package (see <a class="reference internal" href="#package-examples"><span class="std std-ref">Examples</span></a> for
specific examples).  The <code class="docutils literal"><span class="pre">vendor/</span></code> directory is helpful in these scenarios:</p>
<ul class="simple">
<li>You need to include custom packages or binary content that is not accessible
via <code class="docutils literal"><span class="pre">pip</span></code>.  These may be internal packages that aren&#8217;t public.</li>
<li>Wheel files are not available for a package you need from pip.</li>
<li>A package is installable with <code class="docutils literal"><span class="pre">requirements.txt</span></code> but has optional c
extensions. Chalice can build the dependency without the c extensions, but
if you want better performance you can vendor a version that is compiled.</li>
</ul>
<p>As a general rule of thumb, code that you write goes in either <code class="docutils literal"><span class="pre">app.py</span></code> or
<code class="docutils literal"><span class="pre">chalicelib/</span></code>, and dependencies are either specified in <code class="docutils literal"><span class="pre">requirements.txt</span></code>
or placed in the <code class="docutils literal"><span class="pre">vendor/</span></code> directory.</p>
</div>
<div class="section" id="examples">
<span id="package-examples"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Suppose I have the following app structure:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>.
├── app.py
├── chalicelib
│   ├── __init__.py
│   └── utils.py
├── requirements.txt
└── vendor
    └── internalpackage
        └── __init__.py
</pre></div>
</div>
<p>And the <code class="docutils literal"><span class="pre">requirements.txt</span></code> file had one requirement:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cat requirements.txt
sortedcontainers==1.5.4
</pre></div>
</div>
<p>Then the final deployment package directory structure would look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>.
├── app.py
├── chalicelib
│   ├── __init__.py
│   └── utils.py
├── internalpackage
│   └── __init__.py
└── sortedcontainers
    └── __init__.py
</pre></div>
</div>
<p>This directory structure is then zipped up and sent to AWS Lambda during the
deployment process.</p>
</div>
<div class="section" id="cryptography-example">
<h2>Cryptography Example<a class="headerlink" href="#cryptography-example" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Note</p>
<p>Since the original version of this example was written, cryptography has
released version 2.0 which does have manylinux1 wheels available. This
means if you want to use cryptography in a Chalice app all you need to
do is add <code class="docutils literal"><span class="pre">cryptography</span></code> or <code class="docutils literal"><span class="pre">cryptography&gt;=2.0</span></code> in your
requirements.txt file.</p>
<p>This example will use version 1.9 of Cryptography
because it is a good example of a library with C extensions and no wheel
files.</p>
</div></blockquote>
<p>Below shows an example of how to use the
<a class="reference external" href="https://pypi.org/project/cryptography/1.9/">cryptography 1.9</a> package
in a Chalice app for the <code class="docutils literal"><span class="pre">python3.6</span></code> lambda environment.</p>
<p>Suppose you are on a Mac or Windows and want to deploy a Chalice app that
depends on the <code class="docutils literal"><span class="pre">cryptography==1.9</span></code> package. If you simply add it to your
<code class="docutils literal"><span class="pre">requirements.txt</span></code> file and try to deploy it with <code class="docutils literal"><span class="pre">chalice</span> <span class="pre">deploy</span></code> you will
get the following warning during deployment:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cat requirements.txt
cryptography==1.9
$ chalice deploy
Updating IAM policy.
Updating lambda function...
Creating deployment package.

Could not install dependencies:
cryptography==1.9
You will have to build these yourself and vendor them in
the chalice vendor folder.

Your deployment will continue but may not work correctly
if missing dependencies are not present. For more information:
http://chalice.readthedocs.io/en/latest/topics/packaging.html
</pre></div>
</div>
<p>This happened because the <code class="docutils literal"><span class="pre">cryptography</span></code> version 1.9 does not have wheel
files available on PyPi, and has C extensions. Since we are not on the same
platform as AWS Lambda, the compiled C extensions Chalice built were not
compatible. To get around this we are going to leverage the <code class="docutils literal"><span class="pre">vendor/</span></code>
directory, and build the <code class="docutils literal"><span class="pre">cryptography</span></code> package on a compatible linux system.</p>
<p>You can do this yourself by building <code class="docutils literal"><span class="pre">cryptography</span></code> on an Amazon Linux
instance running in EC2. All of the following commands were run inside a
<code class="docutils literal"><span class="pre">python</span> <span class="pre">3.6</span></code> virtual environment.</p>
<ul>
<li><p class="first">Download the source first:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pip download cryptography==1.9
</pre></div>
</div>
<p>This will download all the requirements into the current working directory.
The directory should have the following contents:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">asn1crypto-0.22.0-py2.py3-none-any.whl</span></code></li>
<li><code class="docutils literal"><span class="pre">cffi-1.10.0-cp36-cp36m-manylinux1_x86_64.whl</span></code></li>
<li><code class="docutils literal"><span class="pre">cryptography-1.9.tar.gz</span></code></li>
<li><code class="docutils literal"><span class="pre">idna-2.5-py2.py3-none-any.whl</span></code></li>
<li><code class="docutils literal"><span class="pre">pycparser-2.17.tar.gz</span></code></li>
<li><code class="docutils literal"><span class="pre">six-1.10.0-py2.py3-none-any.whl</span></code></li>
</ul>
<p>This is a complete set of dependencies required for the cryptography package.
Most of these packages have wheels that were downloaded, which means they can
simply be put in the <code class="docutils literal"><span class="pre">requirements.txt</span></code> and Chalice will take care of
downloading them. That leaves <code class="docutils literal"><span class="pre">cryptography</span></code> itself and <code class="docutils literal"><span class="pre">pycparser</span></code> as
the only two that did not have a wheel file available for download.</p>
</li>
<li><p class="first">Next build the <code class="docutils literal"><span class="pre">cryptography</span></code> source package into a wheel file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pip wheel cryptography-1.9.tar.gz
</pre></div>
</div>
<p>This will take a few seconds and build a wheel file for both <code class="docutils literal"><span class="pre">cryptography</span></code>
and <code class="docutils literal"><span class="pre">pycparser</span></code>. The directory should now have two additional wheel files:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">cryptography-1.9-cp36-cp36m-linux_x86_64.whl</span></code></li>
<li><code class="docutils literal"><span class="pre">pycparser-2.17-py2.py3-none-any.whl</span></code></li>
</ul>
<p>The <code class="docutils literal"><span class="pre">cryptography</span></code> wheel file has been built with a compatible
architecture for Lambda (<code class="docutils literal"><span class="pre">linux_x86_64</span></code>) and the <code class="docutils literal"><span class="pre">pycparser</span></code> has been
built for <code class="docutils literal"><span class="pre">any</span></code> architecture which means it can also be automatically
packaged by Chalice if it is listed in the <code class="docutils literal"><span class="pre">requirements.txt</span></code> file.</p>
</li>
<li><p class="first">Download the <code class="docutils literal"><span class="pre">cryptography</span></code> wheel file from the Amazon Linux instance and
unzip it into the <code class="docutils literal"><span class="pre">vendor/</span></code> directory in the root directory of your Chalice
app.</p>
<p>You should now have a project directory that looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tree
.
├── app.py
├── requirements.txt
└── vendor
    ├── cryptography
    │   ├── ... Lots of files
    │
    └── cryptography-1.9.dist-info
        ├── DESCRIPTION.rst
        ├── METADATA
        ├── RECORD
        ├── WHEEL
        ├── entry_points.txt
        ├── metadata.json
        └── top_level.txt
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">requirements.txt</span></code> file should look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cat requirements.txt
cffi==1.10.0
six==1.10.0
asn1crypto==0.22.0
idna==2.5
pycparser==2.17
</pre></div>
</div>
<p>In your <code class="docutils literal"><span class="pre">app.py</span></code> file you can now import <code class="docutils literal"><span class="pre">cryptography</span></code>, and these
dependencies will all get included when the <code class="docutils literal"><span class="pre">chalice</span> <span class="pre">deploy</span></code> command is
run.</p>
</li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">App Packaging</a><ul>
<li><a class="reference internal" href="#app-directories">App Directories</a></li>
<li><a class="reference internal" href="#rd-party-packages">3rd Party Packages</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#cryptography-example">Cryptography Example</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="stages.html" title="previous chapter">Chalice Stages</a></li>
      <li>Next: <a href="pyversion.html" title="next chapter">Python Version Support</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/topics/packaging.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, James Saryerwinnie.
      
      |
      <a href="../_sources/topics/packaging.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>